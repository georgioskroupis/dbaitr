# Cloud Run settings for Firebase App Hosting backend
runConfig:
  minInstances: 0
  maxInstances: 50
  concurrency: 80
  cpu: 1
  memoryMiB: 1024

# Environment configuration
# - NEXT_PUBLIC_* values are baked at build and available in the browser
# - Server-only values should be referenced as secrets in Secret Manager
env:
  # Firebase Web SDK config (public)
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    value: "AIzaSyCXfN1ncMTR0ytj8EEA6lB_sFfBkvWYgO0"
    availability: [ BUILD, RUNTIME ]

  - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
    value: "db8app.firebaseapp.com"
    availability: [ BUILD, RUNTIME ]

  - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
    value: "db8app"
    availability: [ BUILD, RUNTIME ]

  - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
    value: "db8app.firebasestorage.app"
    availability: [ BUILD, RUNTIME ]

  - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: "119149680869"
    availability: [ BUILD, RUNTIME ]

  - variable: NEXT_PUBLIC_FIREBASE_APP_ID
    value: "1:119149680869:web:27e943e5382f8ebf889c0c"
    availability: [ BUILD, RUNTIME ]

  - variable: NEXT_PUBLIC_RECAPTCHA_SITE_KEY
    value: "6LcRhbUrAAAAALuuqUtJPFY_Cv48Y_cXHDcGTdZ9"
    availability: [ BUILD, RUNTIME ]

  - variable: YOUTUBE_CLIENT_ID
    value: "119149680869-158rh01dhojp90va2gji7qdkehitcqks.apps.googleusercontent.com"
    availability:
      - RUNTIME
      
  - variable: YOUTUBE_REDIRECT_URI
    value: "https://dbaitr.com/api/integrations/youtube/oauth/callback"
    availability:
      - RUNTIME
      
  - variable: YOUTUBE_CLIENT_SECRET
    secret: YOUTUBE_CLIENT_SECRET
    availability:
      - RUNTIME

  # Personhood verification runtime configuration
  - variable: IDV_CHALLENGE_TTL_MS
    value: "600000"
    availability: [ RUNTIME ]

  - variable: IDV_SELF_VERIFY_TIMEOUT_MS
    value: "15000"
    availability: [ RUNTIME ]

  # Optional canonical URL
  - variable: NEXT_PUBLIC_APP_URL
    value: "https://dbaitr.com"
    availability: [ BUILD, RUNTIME ]

  # Scheduler OIDC verification (optional; enables auth on /api/analysis/scheduled)
  - variable: SCHEDULER_SERVICE_ACCOUNT_EMAIL
    value: "db8app@appspot.gserviceaccount.com"
    availability: [ RUNTIME ]
  - variable: SCHEDULER_OIDC_AUDIENCE
    value: "https://dbaitr.com/api/analysis/scheduled"
    availability: [ RUNTIME ]

  # Server-only secrets (configure via Secret Manager)
  # Create and grant access using:
  #   firebase apphosting:secrets:set STRIPE_SECRET_KEY --project db8app
  #   firebase apphosting:secrets:set STRIPE_WEBHOOK_SECRET --project db8app
  #   firebase apphosting:secrets:set GEMINI_API_KEY --project db8app
  - variable: STRIPE_SECRET_KEY
    secret: STRIPE_SECRET_KEY
    availability: [ RUNTIME ]

  - variable: STRIPE_WEBHOOK_SECRET
    secret: STRIPE_WEBHOOK_SECRET
    availability: [ RUNTIME ]

  # AI key (the app supports either GOOGLE_API_KEY or GEMINI_API_KEY)
  - variable: GEMINI_API_KEY
    secret: GEMINI_API_KEY
    availability: [ RUNTIME ]

  # If you prefer explicit credentials instead of ADC, you can map
  # FIREBASE_SERVICE_ACCOUNT as a secret here and set it via
  # `firebase apphosting:secrets:set`. We rely on ADC by default,
  # so this mapping is intentionally omitted to avoid requiring
  # the secret during build.
  - variable: IDV_SELF_VERIFY_URL
    secret: IDV_SELF_VERIFY_URL
    availability: [ RUNTIME ]

  # Optional verifier session bootstrap endpoint (returns verificationUrl/sessionId)
  - variable: IDV_SELF_START_URL
    secret: IDV_SELF_START_URL
    availability: [ RUNTIME ]

  # Optional verifier API key sent as X-Idv-Api-Key
  - variable: IDV_SELF_VERIFY_API_KEY
    secret: IDV_SELF_VERIFY_API_KEY
    availability: [ RUNTIME ]

  # Required in production for dedup hashing
  - variable: IDV_DEDUP_HMAC_SECRET
    secret: IDV_DEDUP_HMAC_SECRET
    availability: [ RUNTIME ]
